!function(e){function t(t){for(var n,i,o=t[0],l=t[1],a=0,s=[];a<o.length;a++)i=o[a],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&s.push(r[i][0]),r[i]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);for(c&&c(t);s.length;)s.shift()()}var n={},r={1:0};var i={};var o={1:function(){return{"./index_bg.js":{__wbg_random_5f96f58bd6257873:function(){return n[3].exports.d()},__wbindgen_throw:function(e,t){return n[3].exports.e(e,t)}}}}};function l(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,l),r.l=!0,r.exports}l.e=function(e){var t=[],n=r[e];if(0!==n)if(n)t.push(n[2]);else{var a=new Promise((function(t,i){n=r[e]=[t,i]}));t.push(n[2]=a);var s,f=document.createElement("script");f.charset="utf-8",f.timeout=120,l.nc&&f.setAttribute("nonce",l.nc),f.src=function(e){return l.p+""+({}[e]||e)+".js"}(e);var c=new Error;s=function(t){f.onerror=f.onload=null,clearTimeout(u);var n=r[e];if(0!==n){if(n){var i=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+i+": "+o+")",c.name="ChunkLoadError",c.type=i,c.request=o,n[1](c)}r[e]=void 0}};var u=setTimeout((function(){s({type:"timeout",target:f})}),12e4);f.onerror=f.onload=s,document.head.appendChild(f)}return({0:[1]}[e]||[]).forEach((function(e){var n=i[e];if(n)t.push(n);else{var r,a=o[e](),s=fetch(l.p+""+{1:"471aac2c52ff92f33aa6"}[e]+".module.wasm");if(a instanceof Promise&&"function"==typeof WebAssembly.compileStreaming)r=Promise.all([WebAssembly.compileStreaming(s),a]).then((function(e){return WebAssembly.instantiate(e[0],e[1])}));else if("function"==typeof WebAssembly.instantiateStreaming)r=WebAssembly.instantiateStreaming(s,a);else{r=s.then((function(e){return e.arrayBuffer()})).then((function(e){return WebAssembly.instantiate(e,a)}))}t.push(i[e]=r.then((function(t){return l.w[e]=(t.instance||t).exports})))}})),Promise.all(t)},l.m=e,l.c=n,l.d=function(e,t,n){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(l.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)l.d(n,r,function(t){return e[t]}.bind(null,r));return n},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="",l.oe=function(e){throw console.error(e),e},l.w={};var a=window.webpackJsonp=window.webpackJsonp||[],s=a.push.bind(a);a.push=t,a=a.slice();for(var f=0;f<a.length;f++)t(a[f]);var c=s;l(l.s=0)}([function(e,t,n){Promise.all([n.e(0),n.e(2)]).then(n.bind(null,2)).then(e=>{n.e(0).then(n.bind(null,1)).then(t=>{let n=e.Game.new(),r="begin",i=0,o="",l=void 0,a=Math.min((window.innerHeight-75)/20,(window.innerWidth-20)/10);const s=document.getElementById("tetris-canvas");s.width=10*(a+2)+2,s.height=24*(a+2)+2,s.minWidth="350px";let f=-4*a;document.body.style.transform=`translateY(${f}px)`,document.body.style.marginBottom=f+"px";const c=document.querySelector("#wrapper");c.style.width=10*(a+2)+2+"px",c.style.height=24*(a+2)+2+"px",c.style.marginBottom=c.style+"px",document.querySelector(".glass").style.top=-1*f+2+"px";const u=s.getContext("2d"),d={0:"#000000",1:"#780737",2:"#d29708",3:"#125f03",4:"#e9e2c7",5:"#9b6928",6:"#1c7180",7:"#569f1b"};function h(){if("play"==r&&document.querySelector("textarea")&&document.querySelector("textarea").remove(),"begin"===r)return u.clearRect(0,0,s.width,s.height),u.textAlign="center",u.fillStyle="#5ff2ef",u.font=(s.width<350?"30px":"40px")+" 'Press Start 2P'",u.fillText("Detris",s.width/2,.3*s.height,s.width),u.fillStyle="#ff5050",u.fillText("Detris",s.width/2,.3*s.height-4,s.width),u.fillStyle="#ffffff",u.font=(s.width<350?"16px":"22px")+" 'Press Start 2P'",u.fillText("Hit space",s.width/2,.5*s.height),u.fillText("to start",s.width/2,.5*s.height+30),u.font=(s.width<350?"13px":"15px")+" 'Press Start 2P'",u.fillText("by finiam",s.width/2,.9*s.height),Object.values(d).map((e,t)=>{u.shadowColor="white",u.shadowBlur=0!==t?20:0,u.fillStyle=e,u.fillRect((s.width-8*(a+4))/2+(a+4)*t,.7*s.height,a,a)}),void(u.shadowBlur=0);if("end"===r)return u.clearRect(0,0,s.width,s.height),u.textAlign="center",u.fillStyle="#5ff2ef",u.font=(s.width<350?"30px":"40px")+" 'Press Start 2P'",u.fillText("Detris",s.width/2,.3*s.height),u.fillStyle="#ff5050",u.fillText("Detris",s.width/2-8,.3*s.height-4),u.fillStyle="#ffffff",u.font="22px 'Press Start 2P'",u.fillText("Score:"+i,s.width/2,.5*s.height),u.fillStyle="#ffffff",u.font="10px 'Press Start 2P'",u.font="15px 'Press Start 2P'",u.fillText("by finiam",s.width/2,.9*s.height),void u.drawImage(l,(s.width-120)/2,.5*s.height+50,120,120);const e=n.draw(),o=new Uint8Array(t.memory.buffer,e,240);u.beginPath(),u.clearRect(0,0,s.width,s.height);for(let e=0;e<10;e++)for(let t=4;t<24;t++){const n=24*e+t;u.fillStyle=d[o[n]]||"#0000000",u.shadowColor="white",u.shadowBlur=0!==o[n]?60:0,u.fillRect(e*(a+2)+2,t*(a+2)+2,a,a)}u.stroke()}window.addEventListener("resize",e=>{a=Math.min((window.innerHeight-75)/20,(window.innerWidth-20)/10),s.width=10*(a+2)+2,s.height=24*(a+2)+2,s.marginTop=-4*a+"px"}),document.addEventListener("keypress",e=>{switch(e.code){case"Space":r="play",h();break;case"KeyA":n.input(8),h();break;case"KeyD":n.input(16),h();break;case"KeyW":n.input(2),h();break;case"KeyS":n.input(4),h()}});let p=null;requestAnimationFrame((function t(a){if(p||(p=a),a-p>n.tick_delay()&&(p=a,"play"===r&&n.tick())){r="end",i=n.score(),o=n.inputs(),svg=n.generate_qrcode();const t=document.createElement("textarea");t.setAttribute("spellcheck","false"),t.addEventListener("click",e=>{e.target.select()}),t.value=o.slice(12),document.body.append(t),blob=new Blob([svg.slice(38)],{type:"image/svg+xml"}),l=new Image,l.src=URL.createObjectURL(blob),n.tick_delay=400,n=e.Game.new()}h(),requestAnimationFrame(t)}))})}).catch(console.error)}]);